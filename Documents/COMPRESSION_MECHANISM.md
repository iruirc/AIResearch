# ĞœĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼ ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ² ResearchAI

## ĞĞ±Ğ·Ğ¾Ñ€

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ±ĞµÑĞµĞ´Ğ°Ğ¼Ğ¸, ÑĞ¶Ğ¸Ğ¼Ğ°Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ AI-ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸. Ğ­Ñ‚Ğ¾ Ñ€ĞµÑˆĞ°ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñƒ Ğ¿ĞµÑ€ĞµĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºĞ½Ğ° Ğ¸ ÑĞ½Ğ¸Ğ¶Ğ°ĞµÑ‚ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚Ñ‹ Ğ½Ğ° Ñ‚Ğ¾ĞºĞµĞ½Ñ‹.

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ĞšĞ½Ğ¾Ğ¿ĞºĞ°       â”‚â†’ â”‚   ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ  â”‚â†’ â”‚  API Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹        â”‚  â”‚
â”‚  â”‚  "ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ" â”‚  â”‚   Ğ¾ĞºĞ½Ğ¾       â”‚  â”‚  /compression/*    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    HTTP POST/GET â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              CompressionRoutes (API Layer)                â”‚  â”‚
â”‚  â”‚  â€¢ POST /compression/compress                             â”‚  â”‚
â”‚  â”‚  â€¢ POST /compression/config                               â”‚  â”‚
â”‚  â”‚  â€¢ GET  /compression/config/{sessionId}                   â”‚  â”‚
â”‚  â”‚  â€¢ GET  /compression/check/{sessionId}                    â”‚  â”‚
â”‚  â”‚  â€¢ GET  /compression/archived/{sessionId}                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ChatCompressionService (Business Logic)           â”‚  â”‚
â”‚  â”‚  â€¢ shouldCompress() - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸              â”‚  â”‚
â”‚  â”‚  â€¢ compressSession() - Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ¶Ğ°Ñ‚Ğ¸Ñ                  â”‚  â”‚
â”‚  â”‚  â€¢ summarizeMessages() - AI ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                  â”‚  â”‚
â”‚  â”‚  â€¢ updateCompressionStrategy() - Ğ¡Ğ¼ĞµĞ½Ğ° ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                               â”‚                  â”‚
â”‚               â–¼                               â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ CompressionAlgorithmâ”‚        â”‚  AIProvider (Claude,     â”‚   â”‚
â”‚  â”‚   (Interface)       â”‚        â”‚  OpenAI, HuggingFace)    â”‚   â”‚
â”‚  â”‚                     â”‚        â”‚                          â”‚   â”‚
â”‚  â”‚  â€¢ shouldCompress() â”‚        â”‚  â€¢ sendMessage()         â”‚   â”‚
â”‚  â”‚  â€¢ compress()       â”‚        â”‚  â€¢ generateSummary()     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚   â”‚                   â”‚                 â”‚                       â”‚
â”‚   â–¼                   â–¼                 â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  FULL   â”‚   â”‚ SLIDING â”‚   â”‚    TOKEN     â”‚                 â”‚
â”‚  â”‚REPLACE- â”‚   â”‚ WINDOW  â”‚   â”‚    BASED     â”‚                 â”‚
â”‚  â”‚  MENT   â”‚   â”‚         â”‚   â”‚              â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ChatSession (Data Model)                     â”‚  â”‚
â”‚  â”‚  â€¢ messages: List<Message>                                â”‚  â”‚
â”‚  â”‚  â€¢ archivedMessages: List<Message>                        â”‚  â”‚
â”‚  â”‚  â€¢ compressionConfig: CompressionConfig                   â”‚  â”‚
â”‚  â”‚  â€¢ compressionCount: Int                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¢Ñ€Ğ¸ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸

### 1. FULL_REPLACEMENT (ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½Ğ°)

**ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:** Ğ’ÑĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ¼ĞµĞ½ÑÑÑ‚ÑÑ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹.

**Ğ¡Ñ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:**
```
Ğ”Ğ ĞšĞĞœĞŸĞ Ğ•Ğ¡Ğ¡Ğ˜Ğ˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [USER]      ĞŸÑ€Ğ¸Ğ²ĞµÑ‚!                  â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 1
â”‚ [ASSISTANT] Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ!            â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 2
â”‚ [USER]      Ğ Ğ°ÑÑĞºĞ°Ğ¶Ğ¸ Ğ¾ Python        â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 3
â”‚ [ASSISTANT] Python - ÑÑ‚Ğ¾ ÑĞ·Ñ‹Ğº...     â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 4
â”‚ [USER]      Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ list?          â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 5
â”‚ [ASSISTANT] List - ÑÑ‚Ğ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°...  â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 6
â”‚ [USER]      ĞŸÑ€Ğ¸Ğ²ĞµĞ´Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€           â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 7
â”‚ [ASSISTANT] Ğ’Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: [1,2,3]      â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 8
â”‚ [USER]      Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾                  â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 9
â”‚ [ASSISTANT] ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°!              â”‚ â† Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 10
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        Ğ’ÑĞµĞ³Ğ¾: 10 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹

              AI Ğ¡Ğ£ĞœĞœĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯
                    â†“
              (5-15 ÑĞµĞºÑƒĞ½Ğ´)
                    â†“

ĞŸĞĞ¡Ğ›Ğ• ĞšĞĞœĞŸĞ Ğ•Ğ¡Ğ¡Ğ˜Ğ˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [SYSTEM] === Ğ¡Ğ–ĞĞ¢ĞĞ¯ Ğ˜Ğ¡Ğ¢ĞĞ Ğ˜Ğ¯ ===      â”‚ â† Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
â”‚                                      â”‚
â”‚ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ¾Ğ²Ğ°Ğ»ÑÑ ÑĞ·Ñ‹ĞºĞ¾Ğ¼  â”‚
â”‚ Python. ĞĞ±ÑÑƒĞ´Ğ¸Ğ»Ğ¸ Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹: Ñ‡Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ   â”‚
â”‚ Python, ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… list,       â”‚
â”‚ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ² [1,2,3]â”‚
â”‚                                      â”‚
â”‚ === ĞšĞĞĞ•Ğ¦ Ğ¡Ğ–ĞĞ¢ĞĞ™ Ğ˜Ğ¡Ğ¢ĞĞ Ğ˜Ğ˜ ===        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        Ğ’ÑĞµĞ³Ğ¾: 1 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ

ĞÑ€Ñ…Ğ¸Ğ² (ÑĞºÑ€Ñ‹Ñ‚Ğ¾ Ğ¾Ñ‚ AI, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°):
â””â”€ 10 Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
```

**Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€:** ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ â‰¥ `fullReplacementMessageThreshold` (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 10)

**ĞŸĞ»ÑÑÑ‹:**
- âœ… ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¶Ğ°Ñ‚Ğ¸Ğµ (90%+)
- âœ… ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
- âœ… ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ° Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**ĞœĞ¸Ğ½ÑƒÑÑ‹:**
- âŒ ĞŸĞ¾Ñ‚ĞµÑ€Ñ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
- âŒ Ğ£Ñ‚Ñ€Ğ°Ñ‚Ğ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** Ğ”Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¸, Ğ³Ğ´Ğµ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ°.

---

### 2. SLIDING_WINDOW (Ğ¡ĞºĞ¾Ğ»ÑŒĞ·ÑÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾)

**ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:** Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ ÑĞ¶Ğ¸Ğ¼Ğ°ÑÑ‚ÑÑ, Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N Ğ¾ÑÑ‚Ğ°ÑÑ‚ÑÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹.

**Ğ¡Ñ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:**
```
Ğ”Ğ ĞšĞĞœĞŸĞ Ğ•Ğ¡Ğ¡Ğ˜Ğ˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 1              â”‚ â—„â”€â”
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 1                  â”‚   â”‚
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 2              â”‚   â”‚  Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 2                  â”‚   â”‚  (Ğ±ÑƒĞ´ÑƒÑ‚ ÑĞ¶Ğ°Ñ‚Ñ‹)
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 3              â”‚   â”‚
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 3                  â”‚   â”‚
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 4              â”‚   â”‚
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 4                  â”‚   â”‚
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 5              â”‚   â”‚
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 5                  â”‚ â—„â”€â”˜
â”‚ â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ â”‚
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 6              â”‚ â—„â”€â”
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 6                  â”‚   â”‚  ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ N
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 7              â”‚   â”‚  (Ğ¾ÑÑ‚Ğ°ÑÑ‚ÑÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹)
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 7                  â”‚ â—„â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Ğ’ÑĞµĞ³Ğ¾: 14 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
   slidingWindowKeepLast = 4

              AI Ğ¡Ğ£ĞœĞœĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯
              (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ°Ñ€Ñ‹Ñ…)
                    â†“

ĞŸĞĞ¡Ğ›Ğ• ĞšĞĞœĞŸĞ Ğ•Ğ¡Ğ¡Ğ˜Ğ˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [SYSTEM] === ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢ ===            â”‚ â† Ğ¡ÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ğ°Ñ€Ñ‹Ñ…
â”‚                                      â”‚
â”‚ ĞĞ±ÑÑƒĞ¶Ğ´Ğ°Ğ»Ğ¸ÑÑŒ Ñ‚ĞµĞ¼Ñ‹: ...                â”‚
â”‚ ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹: ...                â”‚
â”‚                                      â”‚
â”‚ === ĞšĞĞĞ•Ğ¦ ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢Ğ ===             â”‚
â”‚ â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ â”‚
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 6              â”‚ â—„â”€ ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 6                  â”‚    Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 7              â”‚    ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 7                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        Ğ’ÑĞµĞ³Ğ¾: 5 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹

ĞÑ€Ñ…Ğ¸Ğ²:
â””â”€ 10 Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ (1-10)
```

**Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€:** ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ â‰¥ `slidingWindowMessageThreshold` (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 12)

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `slidingWindowKeepLast` = 6 (ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ)

**ĞŸĞ»ÑÑÑ‹:**
- âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
- âœ… Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ¶Ğ°Ñ‚Ğ¸ĞµĞ¼ Ğ¸ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹
- âœ… Ğ•ÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ flow Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°

**ĞœĞ¸Ğ½ÑƒÑÑ‹:**
- âš ï¸ Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ ÑĞ¶Ğ°Ñ‚Ğ¸Ğµ (50-70%)
- âš ï¸ Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ñ‡ĞµĞ¼ FULL_REPLACEMENT

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¸, Ğ³Ğ´Ğµ Ğ²Ğ°Ğ¶ĞµĞ½ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚.

---

### 3. TOKEN_BASED (ĞŸĞ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼)

**ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿:** ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ ÑĞ¶Ğ°Ñ‚Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ğ¸ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ².

**Ğ¡Ñ…ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹:**
```
ĞœĞĞĞ˜Ğ¢ĞĞ Ğ˜ĞĞ“ Ğ¢ĞĞšĞ•ĞĞĞ’:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Context Window: 200,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   â”‚
â”‚  Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¾: 160,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² (80%)                    â”‚
â”‚                                                          â”‚
â”‚  ğŸ”” Ğ¢Ğ Ğ˜Ğ“Ğ“Ğ•Ğ : Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚ Ğ¿Ğ¾Ñ€Ğ¾Ğ³ 80%!                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ğ ĞĞ¡Ğ§ĞĞ¢ Ğ“Ğ ĞĞĞ˜Ğ¦Ğ« Ğ¡Ğ–ĞĞ¢Ğ˜Ğ¯:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 1:  5,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚ â—„â”€â”
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 2:  3,200 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 3:  7,500 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 4:  4,800 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  60% Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 5:  6,100 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  (96,000)
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 6:  8,400 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  â†’ Ğ¡Ğ–ĞĞ¢Ğ¬
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 7:  5,600 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 8:  9,200 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 9:  7,300 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 10: 6,900 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚ â—„â”€â”˜
â”‚ â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ â”‚
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 11: 8,100 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚ â—„â”€â”
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 12: 7,200 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 13: 9,500 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  40% Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 14: 6,800 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  (64,000)
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 15: 8,900 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚  â†’ ĞĞ¡Ğ¢ĞĞ’Ğ˜Ğ¢Ğ¬
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 16: 9,100 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 17: 7,400 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚   â”‚
â”‚ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 18: 7,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²          â”‚ â—„â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Ğ’ÑĞµĞ³Ğ¾: 160,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ² 18 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑÑ…
tokenBasedKeepPercent = 0.4 (40%)

              AI Ğ¡Ğ£ĞœĞœĞĞ Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯
              (Ğ¿ĞµÑ€Ğ²Ñ‹Ñ… 10)
                    â†“

ĞŸĞĞ¡Ğ›Ğ• ĞšĞĞœĞŸĞ Ğ•Ğ¡Ğ¡Ğ˜Ğ˜:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [SYSTEM] === ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢ ===            â”‚ â† Ğ¡ÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (2,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)
â”‚ ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ²Ñ‹Ñ… 10         â”‚
â”‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹...                         â”‚
â”‚ === ĞšĞĞĞ•Ğ¦ ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢Ğ ===             â”‚
â”‚ â”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆâ”ˆ â”‚
â”‚ [USER]      Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 11             â”‚ â—„â”€ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 8
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 11                 â”‚    ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
â”‚ ...                                  â”‚    (64,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)
â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 18                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Ğ’ÑĞµĞ³Ğ¾: ~66,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² (41% Ğ¾Ñ‚ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°)

ĞÑ€Ñ…Ğ¸Ğ²:
â””â”€ 10 Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ (96,000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)
```

**Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€:**
```kotlin
currentTokens / contextWindowSize >= tokenBasedThresholdPercent
// 160,000 / 200,000 = 0.8 >= 0.8 âœ“
```

**ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:**
- `tokenBasedThresholdPercent` = 0.8 (80% Ğ¾Ñ‚ Ğ¾ĞºĞ½Ğ°)
- `tokenBasedKeepPercent` = 0.4 (40% Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)

**ĞŸĞ»ÑÑÑ‹:**
- âœ… Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğ°Ğ´ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
- âœ… ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğº Ğ´Ğ»Ğ¸Ğ½Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
- âœ… ĞŸÑ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°

**ĞœĞ¸Ğ½ÑƒÑÑ‹:**
- âš ï¸ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ñ…
- âš ï¸ Ğ¡Ğ»Ğ¾Ğ¶Ğ½ĞµĞµ Ğ² Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:** ĞœĞ¾Ğ´ĞµĞ»Ğ¸ Ñ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ñ‹Ğ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ñ‹Ğ¼ Ğ¾ĞºĞ½Ğ¾Ğ¼.

---

## ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸ (Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°)

### Ğ¤Ğ°Ğ·Ğ° 1: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ĞŸĞĞ›Ğ¬Ğ—ĞĞ’ĞĞ¢Ğ•Ğ›Ğ¬                                 â”‚
â”‚                                                                   â”‚
â”‚  1. ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ñ‡Ğ°Ñ‚ Ñ 15 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼Ğ¸                               â”‚
â”‚  2. ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ" ğŸ—œï¸                             â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          ĞœĞĞ”ĞĞ›Ğ¬ĞĞĞ• ĞĞšĞĞ "ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°"              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹: 15                                             â”‚  â”‚
â”‚  â”‚  Ğ¢Ğ¾ĞºĞµĞ½Ğ¾Ğ²: 45,000                                           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:                                        â”‚  â”‚
â”‚  â”‚  â—‹ ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ·Ğ°Ğ¼ĞµĞ½Ğ°                                           â”‚  â”‚
â”‚  â”‚  â— Ğ¡ĞºĞ¾Ğ»ÑŒĞ·ÑÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾  â† Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚                            â”‚  â”‚
â”‚  â”‚  â—‹ ĞŸĞ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ°Ğ¼                                              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ]  [ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ]  â† ĞĞ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
```

### Ğ¤Ğ°Ğ·Ğ° 2: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (app.js)                           â”‚
â”‚                                                                   â”‚
â”‚  1. GET /compression/config/{sessionId}                          â”‚
â”‚     â† ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ                              â”‚
â”‚                                                                   â”‚
â”‚  2. ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ Ñ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸ĞµĞ¹:                           â”‚
â”‚     {                                                             â”‚
â”‚       strategy: "SLIDING_WINDOW",  â† ĞĞ¾Ğ²Ğ¾Ğµ                       â”‚
â”‚       slidingWindowMessageThreshold: 12,                         â”‚
â”‚       slidingWindowKeepLast: 6,                                  â”‚
â”‚       fullReplacementMessageThreshold: 10,                       â”‚
â”‚       tokenBasedThresholdPercent: 0.8,                           â”‚
â”‚       tokenBasedKeepPercent: 0.4                                 â”‚
â”‚     }                                                             â”‚
â”‚                                                                   â”‚
â”‚  3. POST /compression/config                                     â”‚
â”‚     â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ                             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 BACKEND (CompressionRoutes)                      â”‚
â”‚                                                                   â”‚
â”‚  1. Ğ”ĞµÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ UpdateCompressionConfigRequest                â”‚
â”‚  2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞµÑÑĞ¸Ñ Ğ¸Ğ· ChatSessionManager                       â”‚
â”‚  3. Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ compressionService.updateCompressionStrategy()     â”‚
â”‚  4. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ½Ğ¾Ğ²ÑƒÑ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ² session.compressionConfig    â”‚
â”‚  5. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ UpdateConfigResponse (success: true)             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ°Ğ·Ğ° 3: Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (app.js)                           â”‚
â”‚                                                                   â”‚
â”‚  1. Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾                                     â”‚
â”‚  2. ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ messagesContainer                                    â”‚
â”‚  3. ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€:                                        â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚     â”‚       âŸ³  Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ...    â”‚                   â”‚
â”‚     â”‚   Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ            â”‚                   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                   â”‚
â”‚  4. POST /compression/compress                                   â”‚
â”‚     Body: {                                                       â”‚
â”‚       sessionId: "abc123",                                        â”‚
â”‚       providerId: "CLAUDE",                                       â”‚
â”‚       model: "claude-haiku-4-5-20251001",                        â”‚
â”‚       contextWindowSize: 204800                                  â”‚
â”‚     }                                                             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
```

### Ğ¤Ğ°Ğ·Ğ° 4: Ğ‘ÑĞºĞµĞ½Ğ´ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND (ChatCompressionService)                    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. shouldCompress(session, contextWindowSize)           â”‚   â”‚
â”‚  â”‚     â†“                                                     â”‚   â”‚
â”‚  â”‚     ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: messages.size >= threshold?                â”‚   â”‚
â”‚  â”‚     15 >= 12 âœ“ â†’ true                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                    â”‚
â”‚                              â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  2. compressSession(session, providerId, model)          â”‚   â”‚
â”‚  â”‚     â†“                                                     â”‚   â”‚
â”‚  â”‚     ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼: SlidingWindowCompression          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                    â”‚
â”‚                              â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  3. algorithm.compress(messages, config, summarizeFn)    â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚     a) ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ: keepLast = 6                  â”‚   â”‚
â”‚  â”‚        toCompress = messages[0..8]   (9 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹)       â”‚   â”‚
â”‚  â”‚        toKeep     = messages[9..14]  (6 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹)       â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚     b) Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ summarizeFn(toCompress)                  â”‚   â”‚
â”‚  â”‚        â†’ ChatCompressionService.summarizeMessages()      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                    â”‚
â”‚                              â–¼                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ°Ğ·Ğ° 5: AI ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ChatCompressionService.summarizeMessages()             â”‚
â”‚                                                                   â”‚
â”‚  1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° (ClaudeConfig)             â”‚
â”‚  2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ AIProvider (ClaudeProvider)                          â”‚
â”‚  3. Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚:                                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ [USER] ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, ÑĞ¾Ğ·Ğ´Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‚ĞºÑƒÑ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ        â”‚  â”‚
â”‚     â”‚        ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°:                             â”‚  â”‚
â”‚     â”‚                                                        â”‚  â”‚
â”‚     â”‚ Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:                                            â”‚  â”‚
â”‚     â”‚ 1. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚ĞµĞ¼Ñ‹                              â”‚  â”‚
â”‚     â”‚ 2. Ğ£ĞºĞ°Ğ¶Ğ¸ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹                    â”‚  â”‚
â”‚     â”‚ 3. ĞĞµ ÑƒĞ¿ÑƒÑÑ‚Ğ¸ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸                            â”‚  â”‚
â”‚     â”‚ 4. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€ÑƒĞ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ                            â”‚  â”‚
â”‚     â”‚ 5. Ğ‘ÑƒĞ´ÑŒ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¼                           â”‚  â”‚
â”‚     â”‚                                                        â”‚  â”‚
â”‚     â”‚ [USER] Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ 1...                                 â”‚  â”‚
â”‚     â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 1...                                â”‚  â”‚
â”‚     â”‚ ...                                                    â”‚  â”‚
â”‚     â”‚ [ASSISTANT] ĞÑ‚Ğ²ĞµÑ‚ 9...                                â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº AI:                                      â”‚
â”‚     AIRequest(                                                    â”‚
â”‚       messages = messages + summaryPrompt,                       â”‚
â”‚       model = "claude-haiku-4-5-20251001",                       â”‚
â”‚       parameters = RequestParameters(                            â”‚
â”‚         maxTokens = 4096,  â† ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ğ¸Ğ½Ñ‹                  â”‚
â”‚         temperature = 0.3  â† ĞĞ¸Ğ·ĞºĞ°Ñ Ğ´Ğ»Ñ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸                â”‚
â”‚       )                                                           â”‚
â”‚     )                                                             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼ (5-15 ÑĞµĞºÑƒĞ½Ğ´)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI PROVIDER (Claude)                          â”‚
â”‚                                                                   â”‚
â”‚  ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ğ±ÑÑƒĞ´Ğ¸Ğ» Ñ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ¾Ğ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñâ”‚  â”‚
â”‚  â”‚  Ğ½Ğ° Python. Ğ‘Ñ‹Ğ»Ğ¸ Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ñ‹ Ñ‚ĞµĞ¼Ñ‹: ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ, Ñ‚Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, â”‚  â”‚
â”‚  â”‚  ÑĞ¿Ğ¸ÑĞºĞ¸ Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ğ¸. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ğ» Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¾          â”‚  â”‚
â”‚  â”‚  Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¼ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸. ĞÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ğ» Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹     â”‚  â”‚
â”‚  â”‚  ĞºĞ¾Ğ´Ğ° Ğ¸ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ñ."                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  Response.content â†’ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ Ğ² service                       â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
```

### Ğ¤Ğ°Ğ·Ğ° 6: Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          SlidingWindowCompression.compress()                     â”‚
â”‚                                                                   â”‚
â”‚  1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ AI                                  â”‚
â”‚  2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ:                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ Message(                                               â”‚  â”‚
â”‚     â”‚   role = MessageRole.SYSTEM,                          â”‚  â”‚
â”‚     â”‚   content = """                                        â”‚  â”‚
â”‚     â”‚     === ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢ ĞŸĞ Ğ•Ğ”Ğ«Ğ”Ğ£Ğ©Ğ•Ğ™ Ğ‘Ğ•Ğ¡Ğ•Ğ”Ğ« ===               â”‚  â”‚
â”‚     â”‚                                                        â”‚  â”‚
â”‚     â”‚     ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ğ±ÑÑƒĞ´Ğ¸Ğ» Ñ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ¾Ğ¼...             â”‚  â”‚
â”‚     â”‚     [ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚ AI]                              â”‚  â”‚
â”‚     â”‚                                                        â”‚  â”‚
â”‚     â”‚     === ĞšĞĞĞ•Ğ¦ ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢Ğ ===                           â”‚  â”‚
â”‚     â”‚   """                                                  â”‚  â”‚
â”‚     â”‚ )                                                      â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  3. Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹:                            â”‚
â”‚     newMessages = [systemMessage] + messages[9..14]             â”‚
â”‚                                                                   â”‚
â”‚  4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ CompressionResult:                                â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ CompressionResult(                                     â”‚  â”‚
â”‚     â”‚   newMessages = [1 system + 6 user/assistant],        â”‚  â”‚
â”‚     â”‚   archivedMessages = messages[0..8],                  â”‚  â”‚
â”‚     â”‚   summaryGenerated = true,                            â”‚  â”‚
â”‚     â”‚   originalMessageCount = 15,                          â”‚  â”‚
â”‚     â”‚   newMessageCount = 7,                                â”‚  â”‚
â”‚     â”‚   compressionRatio = 0.533  (53.3%)                   â”‚  â”‚
â”‚     â”‚ )                                                      â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
```

### Ğ¤Ğ°Ğ·Ğ° 7: ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğº ÑĞµÑÑĞ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ChatCompressionService.compressSession()               â”‚
â”‚                                                                   â”‚
â”‚  1. session.archiveMessages(result.archivedMessages)             â”‚
â”‚     â†’ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ 9 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ² archivedMessages                   â”‚
â”‚                                                                   â”‚
â”‚  2. session.replaceMessages(result.newMessages)                  â”‚
â”‚     â†’ Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ messages Ğ½Ğ° 7 Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹                     â”‚
â”‚                                                                   â”‚
â”‚  3. session.compressionCount++                                   â”‚
â”‚     â†’ Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº: 0 â†’ 1                                 â”‚
â”‚                                                                   â”‚
â”‚  4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Result.success(result)                            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CompressionRoutes (POST /compress)                  â”‚
â”‚                                                                   â”‚
â”‚  ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ:                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CompressionResponse(                                       â”‚  â”‚
â”‚  â”‚   success = true,                                          â”‚  â”‚
â”‚  â”‚   compressionPerformed = true,                             â”‚  â”‚
â”‚  â”‚   message = "Compression completed successfully",         â”‚  â”‚
â”‚  â”‚   sessionId = "abc123",                                    â”‚  â”‚
â”‚  â”‚   originalMessageCount = 15,                               â”‚  â”‚
â”‚  â”‚   newMessageCount = 7,                                     â”‚  â”‚
â”‚  â”‚   compressionRatio = 0.533,                                â”‚  â”‚
â”‚  â”‚   archivedMessageCount = 9,                                â”‚  â”‚
â”‚  â”‚   totalCompressions = 1                                    â”‚  â”‚
â”‚  â”‚ )                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ°Ğ·Ğ° 8: ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND (app.js)                             â”‚
â”‚                                                                   â”‚
â”‚  1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ response Ñ compressionPerformed = true              â”‚
â”‚  2. Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸                                  â”‚
â”‚  3. ĞÑ‡Ğ¸Ñ‰Ğ°ĞµÑ‚ messagesContainer                                    â”‚
â”‚  4. Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ loadSessionHistory(sessionId)                       â”‚
â”‚     â†’ Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ 7 Ğ½Ğ¾Ğ²Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ñ Ğ±ÑĞºĞµĞ½Ğ´Ğ°                      â”‚
â”‚                                                                   â”‚
â”‚  5. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ:                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚     â”‚ âœ… ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°                        â”‚  â”‚
â”‚     â”‚                                                        â”‚  â”‚
â”‚     â”‚ Ğ‘Ñ‹Ğ»Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹:     15                                 â”‚  â”‚
â”‚     â”‚ Ğ¡Ñ‚Ğ°Ğ»Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹:    7                                  â”‚  â”‚
â”‚     â”‚ Ğ¡Ğ¶Ğ°Ñ‚Ğ¾:              53%                                â”‚  â”‚
â”‚     â”‚ ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾:       9 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹                        â”‚  â”‚
â”‚     â”‚                                                        â”‚  â”‚
â”‚     â”‚ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° ÑĞ¶Ğ°Ñ‚Ğ°. ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½ Ğ² Ğ²Ğ¸Ğ´Ğµ        â”‚  â”‚
â”‚     â”‚ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹ÑˆĞµ. Ğ’Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ±ĞµÑĞµĞ´Ñƒ.       â”‚  â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  6. ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ:                                           â”‚
â”‚     "ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°: 15 â†’ 7 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ (53%)"              â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Ğ§ĞĞ¢ (Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚)                             â”‚
â”‚                                                                   â”‚
â”‚  [SYSTEM] === ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢ ĞŸĞ Ğ•Ğ”Ğ«Ğ”Ğ£Ğ©Ğ•Ğ™ Ğ‘Ğ•Ğ¡Ğ•Ğ”Ğ« ===                    â”‚
â”‚                                                                   â”‚
â”‚  ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ğ±ÑÑƒĞ´Ğ¸Ğ» Ñ Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ¾Ğ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ñ‹ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ      â”‚
â”‚  Ğ½Ğ° Python. Ğ‘Ñ‹Ğ»Ğ¸ Ñ€Ğ°ÑÑĞ¼Ğ¾Ñ‚Ñ€ĞµĞ½Ñ‹ Ñ‚ĞµĞ¼Ñ‹: ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ, Ñ‚Ğ¸Ğ¿Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…,      â”‚
â”‚  ÑĞ¿Ğ¸ÑĞºĞ¸ Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ğ¸...                                             â”‚
â”‚                                                                   â”‚
â”‚  === ĞšĞĞĞ•Ğ¦ ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢Ğ ===                                        â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  [USER]      ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ 10                                â”‚
â”‚  [ASSISTANT] ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ 10                                 â”‚
â”‚  [USER]      ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ 11                                â”‚
â”‚  [ASSISTANT] ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ 11                                 â”‚
â”‚  [USER]      ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ 12                                â”‚
â”‚  [ASSISTANT] ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ 12                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ… ĞšĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ñ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°                            â”‚ â”‚
â”‚  â”‚ Ğ‘Ñ‹Ğ»Ğ¾: 15 â†’ Ğ¡Ñ‚Ğ°Ğ»Ğ¾: 7 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  ğŸ’¬ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³...                     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ChatSession

```kotlin
data class ChatSession(
    val id: String,

    // ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ (Ğ²Ğ¸Ğ´Ğ½Ñ‹ AI)
    private val _messages: MutableList<Message>,

    // ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ (ÑĞºÑ€Ñ‹Ñ‚Ñ‹ Ğ¾Ñ‚ AI, Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ°)
    private val _archivedMessages: MutableList<Message>,

    // ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸
    var compressionConfig: CompressionConfig,

    // Ğ¡Ñ‡Ñ‘Ñ‚Ñ‡Ğ¸Ğº Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¹
    var compressionCount: Int = 0,

    val createdAt: Long,
    var lastAccessedAt: Long,
    val assistantId: String? = null
) {
    val messages: List<Message> get() = _messages.toList()
    val archivedMessages: List<Message> get() = _archivedMessages.toList()

    fun archiveMessages(messages: List<Message>) {
        _archivedMessages.addAll(messages)
    }

    fun replaceMessages(newMessages: List<Message>) {
        _messages.clear()
        _messages.addAll(newMessages)
        lastAccessedAt = System.currentTimeMillis()
    }

    fun getTotalTokens(): Int {
        return _messages.sumOf {
            it.metadata?.totalTokens ?: it.metadata?.estimatedTotalTokens ?: 0
        }
    }
}
```

**Ğ–Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹:**
```
ĞĞ¾Ğ²Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ â†’ _messages (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ)
                         â†“
                   [ĞšĞĞœĞŸĞ Ğ•Ğ¡Ğ¡Ğ˜Ğ¯]
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                                 â–¼
_archivedMessages            _messages (ÑĞ¶Ğ°Ñ‚Ñ‹Ğµ + Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ)
(ÑĞºÑ€Ñ‹Ñ‚Ñ‹ Ğ¾Ñ‚ AI)               (Ğ²Ğ¸Ğ´Ğ½Ñ‹ AI)
```

### CompressionConfig

```kotlin
@Serializable
data class CompressionConfig(
    // Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ
    val strategy: CompressionStrategy = FULL_REPLACEMENT,

    // ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ FULL_REPLACEMENT
    val fullReplacementMessageThreshold: Int = 10,

    // ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ SLIDING_WINDOW
    val slidingWindowMessageThreshold: Int = 12,
    val slidingWindowKeepLast: Int = 6,

    // ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ TOKEN_BASED
    val tokenBasedThresholdPercent: Double = 0.8,
    val tokenBasedKeepPercent: Double = 0.4
)
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸:**
```
ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ°Ñ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ strategy: FULL_REPLACEMENT         â”‚
â”‚ fullReplacementMessageThreshold: 10â”‚
â”‚ slidingWindowMessageThreshold: 12  â”‚
â”‚ slidingWindowKeepLast: 6           â”‚
â”‚ tokenBasedThresholdPercent: 0.8    â”‚
â”‚ tokenBasedKeepPercent: 0.4         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚
           â”‚ "Ğ¡ĞºĞ¾Ğ»ÑŒĞ·ÑÑ‰ĞµĞµ Ğ¾ĞºĞ½Ğ¾"
           â–¼
ĞĞ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ğ°Ñ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ strategy: SLIDING_WINDOW â† Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¾â”‚
â”‚ fullReplacementMessageThreshold: 10â”‚
â”‚ slidingWindowMessageThreshold: 12  â”‚
â”‚ slidingWindowKeepLast: 6           â”‚
â”‚ tokenBasedThresholdPercent: 0.8    â”‚
â”‚ tokenBasedKeepPercent: 0.4         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CompressionResult

```kotlin
data class CompressionResult(
    val newMessages: List<Message>,         // ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
    val archivedMessages: List<Message>,    // ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
    val summaryGenerated: Boolean,          // Ğ‘Ñ‹Ğ»Ğ° Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ° ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
    val originalMessageCount: Int,          // Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
    val newMessageCount: Int,               // ĞĞ¾Ğ²Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
    val compressionRatio: Double            // ĞšĞ¾ÑÑ„Ñ„Ğ¸Ñ†Ğ¸ĞµĞ½Ñ‚ ÑĞ¶Ğ°Ñ‚Ğ¸Ñ
)
```

---

## Fallback Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼

Ğ•ÑĞ»Ğ¸ AI-ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ ÑƒĞ´Ğ°Ğ»Ğ°ÑÑŒ (Ğ¾ÑˆĞ¸Ğ±ĞºĞ° API, Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚), Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ fallback:

```kotlin
private fun generateFallbackSummary(messages: List<Message>): String {
    val userMessages = messages.filter { it.role == MessageRole.USER }.size
    val assistantMessages = messages.filter { it.role == MessageRole.ASSISTANT }.size

    return """
        Ğ”Ğ¸Ğ°Ğ»Ğ¾Ğ³ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ $userMessages ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        Ğ¸ $assistantMessages Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ°.

        ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚ĞµĞ¼Ñ‹ Ğ¾Ğ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ñ:
        ${messages.take(3).joinToString("\n") { msg ->
            val content = when (val c = msg.content) {
                is MessageContent.Text -> c.text.take(100)
                is MessageContent.MultiModal -> c.text?.take(100) ?: "[ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ]"
            }
            "- ${msg.role}: $content..."
        }}

        [ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ]
    """.trimIndent()
}
```

**Ğ¡Ñ…ĞµĞ¼Ğ° fallback:**
```
AI Ğ¡ÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
      â†“
  â”Œâ”€â”€â”€â”´â”€â”€â”€â”
  â”‚ Try   â”‚
  â””â”€â”€â”€â”¬â”€â”€â”€â”˜
      â”‚
      â”œâ”€ Ğ£ÑĞ¿ĞµÑ… â†’ Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ AI summary
      â”‚
      â””â”€ ĞÑˆĞ¸Ğ±ĞºĞ° (Exception)
            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  generateFallbackSummary()â”‚
        â”‚  â€¢ ĞŸĞ¾Ğ´ÑÑ‡Ñ‘Ñ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹      â”‚
        â”‚  â€¢ Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ²Ñ‹Ñ… 3    â”‚
        â”‚  â€¢ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
        Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
```

---

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ğ¤Ğ°Ğ·Ğ°                          Ğ’Ñ€ĞµĞ¼Ñ       % Ğ¾Ñ‚ Ğ¾Ğ±Ñ‰ĞµĞ³Ğ¾     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° shouldCompress()   < 1 Ğ¼Ñ         0%         â”‚
â”‚  2. ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ°        < 1 Ğ¼Ñ         0%         â”‚
â”‚  3. Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹        < 1 Ğ¼Ñ         0%         â”‚
â”‚  4. AI ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ             5-15 Ñ        99%         â”‚
â”‚     â”œâ”€ Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ°     < 10 Ğ¼Ñ                   â”‚
â”‚     â”œâ”€ HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº AI         100-500 Ğ¼Ñ                â”‚
â”‚     â”œâ”€ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° AI             4-14 Ñ                    â”‚
â”‚     â””â”€ ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°           < 10 Ğ¼Ñ                   â”‚
â”‚  5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ result             < 1 Ğ¼Ñ         0%         â”‚
â”‚  6. ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğº ÑĞµÑÑĞ¸Ğ¸         < 1 Ğ¼Ñ         0%         â”‚
â”‚  7. Ğ¡ĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°         < 1 Ğ¼Ñ         0%         â”‚
â”‚  8. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ° Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğµ       100-300 Ğ¼Ñ     1%         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Ğ˜Ğ¢ĞĞ“Ğ:                         5-16 ÑĞµĞºÑƒĞ½Ğ´   100%        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”‘ Ğ£Ğ·ĞºĞ¾Ğµ Ğ¼ĞµÑÑ‚Ğ¾: AI ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (99% Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸)
```

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**1. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ´Ğ»Ñ ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**
```kotlin
val selectedModel = "claude-haiku-4-5-20251001"  // Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ
parameters = RequestParameters(
    maxTokens = 4096,      // ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ğ¸Ğ½Ñ‹ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°
    temperature = 0.3      // ĞĞ¸Ğ·ĞºĞ°Ñ Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¸Ğ·Ğ¼Ğ°
)
```

**2. ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¹:**
```kotlin
// ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·
val config = configRepository.getProviderConfig(providerId)
    .getOrNull() ?: throw IllegalStateException(...)
```

**3. ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
```kotlin
suspend fun compressSession(...): Result<CompressionResult>
// â†‘ Suspend Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ¾Ñ‚Ğ¾Ğº
```

**4. Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:**
```kotlin
// Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… data class
// Ğ²Ğ¼ĞµÑÑ‚Ğ¾ mapOf() Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼Ğ¸ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼Ğ¸
call.respond(HttpStatusCode.OK, CompressionResponse(...))
```

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

### ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

1. **ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ»Ğ¸Ğ½Ğ° ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** 4096 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
2. **Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ AI Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:** 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ (300 ÑĞµĞºÑƒĞ½Ğ´)
3. **ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸:**
   - FULL_REPLACEMENT: 10 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
   - SLIDING_WINDOW: 12 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
   - TOKEN_BASED: 80% context window

### ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  1. Ğ¡ĞµÑÑĞ¸Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°                           â”‚
â”‚     â†’ 404 Not Found                             â”‚
â”‚                                                 â”‚
â”‚  2. ĞĞµĞ²ĞµÑ€Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ                       â”‚
â”‚     â†’ 400 Bad Request                           â”‚
â”‚                                                 â”‚
â”‚  3. AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½                     â”‚
â”‚     â†’ Fallback ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                     â”‚
â”‚                                                 â”‚
â”‚  4. Ğ¢Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚ AI Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°                          â”‚
â”‚     â†’ Fallback ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                     â”‚
â”‚                                                 â”‚
â”‚  5. ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸                         â”‚
â”‚     â†’ 500 Internal Server Error                 â”‚
â”‚                                                 â”‚
â”‚  6. ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹                      â”‚
â”‚     â†’ compressionPerformed = false              â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```kotlin
// ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:

logger.info("Starting compression for session ${session.id}
             with strategy ${session.compressionConfig.strategy}")

logger.info("Generating summary for ${messages.size} messages
             using provider $providerId")

logger.info("Compression completed for session ${session.id}.
             Original: ${result.originalMessageCount},
             New: ${result.newMessageCount},
             Ratio: ${"%.2f".format(result.compressionRatio * 100)}%")

logger.error("Error during compression for session ${session.id}:
              ${e.message}", e)
```

---

## Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸

| Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ | ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° |
|----------|-------------------------|---------|
| Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° | SLIDING_WINDOW | Ğ’Ğ°Ğ¶ĞµĞ½ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ |
| ĞĞ±ÑƒÑ‡Ğ°ÑÑ‰Ğ¸Ğ¹ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ | FULL_REPLACEMENT | ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ±Ğ¾Ğ±Ñ‰Ğ¸Ñ‚ÑŒ Ğ²ÑÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ |
| Long-running Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ | TOKEN_BASED | Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğ°Ğ´ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ğ¼Ğ¸ |
| Brainstorming | SLIDING_WINDOW | Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ²ĞµĞ¶Ğ¸Ñ… Ğ¸Ğ´ĞµĞ¹ |
| Code review | SLIDING_WINDOW | ĞĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ²Ğ°Ğ¶Ğ½ĞµĞµ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… |

### ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ²

**Production (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ñ‹Ğµ):**
```kotlin
fullReplacementMessageThreshold = 10   // âœ… ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾
slidingWindowMessageThreshold = 12     // âœ… ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾
slidingWindowKeepLast = 6              // âœ… Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ
tokenBasedThresholdPercent = 0.8       // âœ… 80% Ğ·Ğ°Ğ¿Ğ°Ñ
```

**Development/Testing (Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸):**
```kotlin
fullReplacementMessageThreshold = 2    // Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ ÑÑ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ
slidingWindowMessageThreshold = 3
slidingWindowKeepLast = 2
tokenBasedThresholdPercent = 0.5       // 50% Ğ´Ğ»Ñ Ñ‡Ğ°ÑÑ‚Ñ‹Ñ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²
```

---

## Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞºĞ¾Ğ¼Ğ¿Ñ€ĞµÑÑĞ¸Ğ¸ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ² ResearchAI Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚:

âœ… **Ğ¢Ñ€Ğ¸ Ğ³Ğ¸Ğ±ĞºĞ¸Ñ… ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸** Ğ½Ğ° Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
âœ… **AI-powered ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** Ñ fallback Ğ¼ĞµÑ…Ğ°Ğ½Ğ¸Ğ·Ğ¼Ğ¾Ğ¼
âœ… **ĞÑ€Ñ…Ğ¸Ğ²Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
âœ… **ĞšÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹ UI** Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¾Ğ¹
âœ… **Production-ready** ĞºĞ¾Ğ´ Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
âœ… **ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ** Ğ´Ğ»Ñ Ğ»ÑĞ±Ñ‹Ñ… Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ² Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ²

Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ: **5-16 ÑĞµĞºÑƒĞ½Ğ´**
Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²: **50-90%**
Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ°: **100% Ñ‡ĞµÑ€ĞµĞ· ÑÑƒĞ¼Ğ¼Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ**

ğŸ‰ **Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾ Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ!**
