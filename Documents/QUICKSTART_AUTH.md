# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ **Google** —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API
- –°–µ—Å—Å–∏–∏ –¥–ª—è Web UI
- –ö—Ä–∞—Å–∏–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google OAuth (5 –º–∏–Ω—É—Ç)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://console.cloud.google.com/
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í –º–µ–Ω—é —Å–ª–µ–≤–∞: **APIs & Services** ‚Üí **Credentials**
4. –ù–∞–∂–º–∏—Ç–µ **Create Credentials** ‚Üí **OAuth 2.0 Client ID**
5. –í—ã–±–µ—Ä–∏—Ç–µ **Web application**
6. –í **Authorized redirect URIs** –¥–æ–±–∞–≤—å—Ç–µ:
   ```
   http://localhost:8080/auth/google/callback
   ```
7. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Client ID** –∏ **Client Secret**

### 2. –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª

–í–∞—à `.env` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ. –ü—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```bash
# JWT Authentication (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
JWT_SECRET=researchai-super-secret-key-please-change-in-production-min-256-bits-abcdef1234567890
JWT_ISSUER=researchai
JWT_AUDIENCE=researchai-users
JWT_REALM=ResearchAI
JWT_EXPIRATION_MS=3600000

# Google OAuth - –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ
GOOGLE_CLIENT_ID=–≤–∞—à-client-id-–æ—Ç-google
GOOGLE_CLIENT_SECRET=–≤–∞—à-client-secret-–æ—Ç-google
GOOGLE_REDIRECT_URI=http://localhost:8080/auth/google/callback
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
./gradlew run
```

### 4. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

```
http://localhost:8080
```

–í—ã —É–≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google" –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å!

## üì± –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

1. –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ Google –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
2. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤–µ—Ä–Ω–µ—Ç–µ—Å—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—Å—Ç –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `data/users/`
4. JWT —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage –±—Ä–∞—É–∑–µ—Ä–∞
5. –í—ã –ø–æ–ø–∞–¥–µ—Ç–µ –≤ —á–∞—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
6. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É –±—É–¥–µ—Ç –∫–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏"

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è **—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**. –î–ª—è production:

1. **–ò–∑–º–µ–Ω–∏—Ç–µ JWT_SECRET**:
   ```bash
   # –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
   openssl rand -base64 64
   ```

2. **–í–∫–ª—é—á–∏—Ç–µ HTTPS** –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   ```kotlin
   cookie.secure = true  // –≤ Application.kt
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google OAuth –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞**

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `GET /login.html` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
- `GET /auth/google` - –ù–∞—á–∞—Ç—å OAuth —Å Google
- `GET /auth/google/callback` - OAuth callback
- `GET /auth/logout` - –í—ã—Ö–æ–¥
- `GET /auth/me` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### API (—Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- `POST /chat` - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
- `GET /sessions` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π
- –ò –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints

## üêõ Troubleshooting

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–û—à–∏–±–∫–∞**: `JWT_SECRET not set`

‚úÖ **–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `.env` —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç `JWT_SECRET`

---

### Redirect URI mismatch

**–û—à–∏–±–∫–∞**: `redirect_uri_mismatch` –æ—Ç Google

‚úÖ **–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ Google Console –¥–æ–±–∞–≤–ª–µ–Ω —Ç–æ—á–Ω—ã–π URI: `http://localhost:8080/auth/google/callback`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `GOOGLE_REDIRECT_URI` –≤ `.env` —Å–æ–≤–ø–∞–¥–∞–µ—Ç

---

### OAuth state mismatch

**–û—à–∏–±–∫–∞**: `OAuth state mismatch` –≤ –ª–æ–≥–∞—Ö

‚úÖ **–†–µ—à–µ–Ω–∏–µ**:
- –û—á–∏—Å—Ç–∏—Ç–µ cookies –±—Ä–∞—É–∑–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ cookies –≤–∫–ª—é—á–µ–Ω—ã
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä

---

### "Not authenticated" –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

**–û—à–∏–±–∫–∞**: –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ login.html

‚úÖ **–†–µ—à–µ–Ω–∏–µ**:
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Local Storage
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `jwt_token`
3. –ï—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏ JavaScript
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ

## üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º–æ—Ç—Ä–∏—Ç–µ `AUTH_README.md` –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (GitHub, Apple)
- API reference

## ‚ú® –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –º–æ–∂–µ—Ç–µ:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∞—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ
2. –í—Å–µ –≤–∞—à–∏ —Å–µ—Å—Å–∏–∏ –±—É–¥—É—Ç –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –≤–∞—à–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É
3. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –≤—Ö–æ–¥–∞–º–∏
4. –ú–æ–∂–Ω–æ –≤—ã–π—Ç–∏ –∏ –≤–æ–π—Ç–∏ —Å–Ω–æ–≤–∞ - –≤—Å–µ —Å–µ—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è

–ì–æ—Ç–æ–≤–æ! üéâ
