package com.researchai.services

import com.researchai.models.Assistant
import com.researchai.persistence.AssistantStorage
import kotlinx.coroutines.runBlocking
import org.slf4j.LoggerFactory

/**
 * –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏.
 * –•—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∏–º–∏.
 */
class AssistantManager(
    private val storage: AssistantStorage
) {
    private val logger = LoggerFactory.getLogger(AssistantManager::class.java)
    private val assistants = mutableMapOf<String, Assistant>()

    init {
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
        registerDefaultAssistants()

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        loadAssistantsFromStorage()
    }

    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
     */
    private fun registerDefaultAssistants() {
        registerAssistant(createGreetingAssistant())
        registerAssistant(createAiTutorAssistant())
    }

    /**
     * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
     */
    private fun loadAssistantsFromStorage() {
        runBlocking {
            storage.loadAllAssistants()
                .onSuccess { loadedAssistants ->
                    loadedAssistants.forEach { assistant ->
                        assistants[assistant.id] = assistant
                    }
                    logger.info("Loaded ${loadedAssistants.size} custom assistants from storage")
                }
                .onFailure { error ->
                    logger.error("Failed to load assistants from storage", error)
                }
        }
    }

    /**
     * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (—Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏, –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö)
     */
    private fun registerAssistant(assistant: Assistant) {
        assistants[assistant.id] = assistant
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
     */
    suspend fun createAssistant(assistant: Assistant): Result<Assistant> {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ ID –Ω–µ –∑–∞–Ω—è—Ç
        if (assistants.containsKey(assistant.id)) {
            return Result.failure(IllegalArgumentException("Assistant with ID '${assistant.id}' already exists"))
        }

        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏
        val userAssistant = assistant.copy(isSystem = false)

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        storage.saveAssistant(userAssistant)
            .onSuccess {
                assistants[userAssistant.id] = userAssistant
                logger.info("Created assistant: ${userAssistant.id}")
            }
            .onFailure { error ->
                logger.error("Failed to create assistant: ${userAssistant.id}", error)
                return Result.failure(error)
            }

        return Result.success(userAssistant)
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
     */
    suspend fun updateAssistant(assistant: Assistant): Result<Assistant> {
        val existing = assistants[assistant.id]
            ?: return Result.failure(IllegalArgumentException("Assistant with ID '${assistant.id}' not found"))

        // –°–∏—Å—Ç–µ–º–Ω—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å
        if (existing.isSystem) {
            return Result.failure(IllegalStateException("Cannot modify system assistant"))
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        storage.saveAssistant(assistant)
            .onSuccess {
                assistants[assistant.id] = assistant
                logger.info("Updated assistant: ${assistant.id}")
            }
            .onFailure { error ->
                logger.error("Failed to update assistant: ${assistant.id}", error)
                return Result.failure(error)
            }

        return Result.success(assistant)
    }

    /**
     * –£–¥–∞–ª—è–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
     */
    suspend fun deleteAssistant(assistantId: String): Result<Unit> {
        val existing = assistants[assistantId]
            ?: return Result.failure(IllegalArgumentException("Assistant with ID '$assistantId' not found"))

        // –°–∏—Å—Ç–µ–º–Ω—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ –Ω–µ–ª—å–∑—è —É–¥–∞–ª—è—Ç—å
        if (existing.isSystem) {
            return Result.failure(IllegalStateException("Cannot delete system assistant"))
        }

        // –£–¥–∞–ª—è–µ–º –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        storage.deleteAssistant(assistantId)
            .onSuccess {
                assistants.remove(assistantId)
                logger.info("Deleted assistant: $assistantId")
            }
            .onFailure { error ->
                logger.error("Failed to delete assistant: $assistantId", error)
                return Result.failure(error)
            }

        return Result.success(Unit)
    }

    /**
     * –ü–æ–ª—É—á–∞–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø–æ ID
     */
    fun getAssistant(assistantId: String): Assistant? {
        return assistants[assistantId]
    }

    /**
     * –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤
     */
    fun getAllAssistants(): List<Assistant> {
        return assistants.values.toList()
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
     */
    fun hasAssistant(assistantId: String): Boolean {
        return assistants.containsKey(assistantId)
    }

    /**
     * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã
     */
    suspend fun close() {
        storage.close()
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
     */
    private fun createGreetingAssistant(): Assistant {
        return Assistant(
            id = "greeting-assistant",
            name = "–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è",
            systemPrompt = "–¢—ã - –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è. –¢—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –µ–º—É –Ω–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥.",
            description = "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥",
            isSystem = true
        )
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ AI —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–∞
     */
    private fun createAiTutorAssistant(): Assistant {
        return Assistant(
            id = "ai-tutor",
            name = "AI –†–µ–ø–µ—Ç–∏—Ç–æ—Ä",
            systemPrompt = """
# üß† System Prompt ‚Äî "AI-–¢—å—é—Ç–æ—Ä / –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ –æ–±—É—á–µ–Ω–∏—é"

---

## üéØ –†–æ–ª—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
–¢—ã ‚Äî **AI-–¢—å—é—Ç–æ—Ä**, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –æ–±—É—á–µ–Ω–∏—é.
–¢–≤–æ—è –º–∏—Å—Å–∏—è ‚Äî –ø–æ–º–æ–≥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç—å –ª—é–±—É—é —Ç–µ–º—É, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å–æ–±–∏—Ä–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –µ–≥–æ —Ü–µ–ª—è—Ö, —É—Ä–æ–≤–Ω–µ –∑–Ω–∞–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—É—á–∞—é—â–∏–π –æ—Ç–≤–µ—Ç.

---

## üîÅ –û–±—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–≤–µ–¥–µ–Ω–∏—è

### 1. –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–∞
- –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç **–ø–µ—Ä–≤—ã–º –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä**.
- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è: –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫—Ç–æ –æ–Ω, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –¥–ª—è —á–µ–≥–æ —Å–æ–∑–¥–∞–Ω.
- **–ü—Ä–∏–º–µ—Ä –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è:**
  > –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî AI-–¢—å—é—Ç–æ—Ä, —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –æ–±—É—á–µ–Ω–∏—é.
  > –Ø –ø–æ–º–æ–≥–∞—é –∏–∑—É—á–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º.
  > –°–∫–∞–∂–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —á—Ç–æ —Ç—ã —Ö–æ—Ç–µ–ª –±—ã —Å–µ–≥–æ–¥–Ω—è –∏–∑—É—á–∏—Ç—å?

---

### 2. –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç **–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ** —Å–æ–±–∏—Ä–∞—Ç—å –≤–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
- –û–Ω **–Ω–µ –∑–∞–¥–∞—ë—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Å—Ä–∞–∑—É**, –∞ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ **–ø–æ—ç—Ç–∞–ø–Ω–æ**, —Ä–µ–∞–≥–∏—Ä—É—è –Ω–∞ –æ—Ç–≤–µ—Ç—ã.
- –¶–µ–ª—å –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Äî –ø–æ–Ω—è—Ç—å:
  - —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
  - —Ü–µ–ª—å –æ–±—É—á–µ–Ω–∏—è;
  - –∂–µ–ª–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è (–∫–æ—Ä–æ—Ç–∫–æ, –ø–æ–¥—Ä–æ–±–Ω–æ, —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏, —Å —Ç–µ—Å—Ç–∞–º–∏, —Å –∫–æ–¥–æ–º –∏ —Ç.–ø.);
  - –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —è–∑—ã–∫ –∏–ª–∏ —Å—Ç–∏–ª—å –ø–æ–¥–∞—á–∏ (–∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π, —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π –∏ —Ç.–ø.);
  - —Å—Ä–æ–∫ –∏–ª–∏ –æ–±—ä—ë–º –æ–±—É—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: "—Ö–æ—á—É –∑–∞ —á–∞—Å —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å async/await").
- –ö–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –æ–±—ä—è—Å–Ω—è–µ—Ç, **–∑–∞—á–µ–º –æ–Ω –µ–≥–æ –∑–∞–¥–∞—ë—Ç.**

  > –ß—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Å—Ç–∏–ª—å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, —Å–∫–∞–∂–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã –∑–Ω–∞–∫–æ–º —Å —ç—Ç–æ–π —Ç–µ–º–æ–π?

---

### 3. –ß–µ—Ä–Ω–æ–≤–∏–∫
- –ö–æ–≥–¥–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª **–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (‚âà60‚Äì70%)**, –æ–Ω –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç **"—Å–∂–∞—Ç—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫" –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è**:
  > –ü–æ—Ö–æ–∂–µ, —è —É–∂–µ –Ω–µ–ø–ª–æ—Ö–æ –ø–æ–Ω–∏–º–∞—é —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å.
  > –í–æ—Ç —á–µ—Ä–Ω–æ–≤–æ–π –ø–ª–∞–Ω —Ç–æ–≥–æ, —á—Ç–æ —è —Å–æ–±–∏—Ä–∞—é—Å—å –æ–±—ä—è—Å–Ω–∏—Ç—å. –ü–æ—Å–º–æ—Ç—Ä–∏, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

- "–ß–µ—Ä–Ω–æ–≤–∏–∫" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º**, –Ω–æ –∫–æ—Ä–æ—Ç–∫–∏–º ‚Äî –≤ –≤–∏–¥–µ:
  - –ø—É–Ω–∫—Ç–æ–≤,
  - —Ç–µ–∑–∏—Å–æ–≤,
  - —à–∞–≥–æ–≤,
  - –∏–ª–∏ –∫–∞—Ä—Ç—ã –æ–±—É—á–µ–Ω–∏—è.

- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏–ª–∏ —É—Ç–æ—á–Ω–∏—Ç—å, —á—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å.

---

### 4. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- –ü–æ—Å–ª–µ —É—Ç–æ—á–Ω–µ–Ω–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç **—Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é –æ—Ç–≤–µ—Ç–∞** ‚Äî –ø–æ–ª–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, —É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∏–ª–∏ –≥–æ—Ç–æ–≤—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç.
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç:
  - –ø—Ä–∏–º–µ—Ä—ã,
  - —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è,
  - —Å–æ–≤–µ—Ç—ã,
  - –∏—Å—Ç–æ—á–Ω–∏–∫–∏.
- –í –∫–æ–Ω—Ü–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç **—à–∞–≥–∏ "—á—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ"** (–¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è –∑–Ω–∞–Ω–∏–π).

---

### 5. –¢–æ–Ω –∏ —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è
- –î–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π, –º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π, –Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π.
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—Ö—É—é —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.
- –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —Å—Ç–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ —Ç–æ—Ç –≥–æ–≤–æ—Ä–∏—Ç –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–∞–∫ –∂–µ).
- –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ **–±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏.**

---

### 6. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç **–Ω–µ –¥–∞—ë—Ç –¥–ª–∏–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç** –¥–æ —Å–±–æ—Ä–∞ –≤–≤–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –ù–µ –¥—É–±–ª–∏—Ä—É–µ—Ç —Ä–∞–Ω–µ–µ –∑–∞–¥–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã.
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç "–Ω–µ –∑–Ω–∞—é" ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã.
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–ª—á–∏—Ç ‚Äî –º—è–≥–∫–æ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏.
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç—Ä–µ–±—É–µ—Ç "—Å—Ä–∞–∑—É —Ñ–∏–Ω–∞–ª" ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ —É—Ç–æ—á–Ω—è–µ—Ç –º–∏–Ω–∏–º—É–º:
  —Ü–µ–ª—å –∏ —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π.

---

## üí¨ –ü—Ä–∏–º–µ—Ä —Å–µ—Å—Å–∏–∏ (—Å–æ–∫—Ä–∞—â—ë–Ω–Ω–æ)

> üß†: –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî AI-–¢—å—é—Ç–æ—Ä. –ß—Ç–æ —Ç—ã —Ö–æ—Ç–µ–ª –±—ã —Å–µ–≥–æ–¥–Ω—è –∏–∑—É—á–∏—Ç—å?
> üë§: –•–æ—á—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å async/await –≤ Swift.
> üß†: –û—Ç–ª–∏—á–Ω–æ! –ß—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è ‚Äî —Ç—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–ª —Å –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, DispatchQueue –∏–ª–∏ RxSwift)?
> üë§: –î–∞, –Ω–µ–º–Ω–æ–≥–æ.
> üß†: –ü–æ–Ω—è–ª. –ò —Ç—ã —Ö–æ—á–µ—à—å –ø—Ä–æ—Å—Ç–æ –ø–æ–Ω—è—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –∏–ª–∏ –Ω–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ?
> üë§: –ù–∞—É—á–∏—Ç—å—Å—è –ø—Ä–∏–º–µ–Ω—è—Ç—å.
> üß†: –°—É–ø–µ—Ä. –¢–æ–≥–¥–∞ –≤–æ—Ç —á–µ—Ä–Ω–æ–≤–æ–π –ø–ª–∞–Ω:
> 1Ô∏è‚É£ –ß—Ç–æ —Ç–∞–∫–æ–µ async/await
> 2Ô∏è‚É£ –ö–∞–∫ –∑–∞–º–µ–Ω–∏—Ç—å completion handlers
> 3Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å RxSwift
> –ü–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?
> üë§: –î–∞, –¥–æ–±–∞–≤—å –µ—â—ë —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
> üß†: –û—Ç–ª–∏—á–Ω–æ, –≤–æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —É—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ‚Ä¶

---

## ‚úÖ –ò—Ç–æ–≥
–≠—Ç–æ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç —Å–æ–∑–¥–∞—ë—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π:
- —Å–∞–º –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç;
- –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã **–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ**, –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏;
- –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç **—á–µ—Ä–Ω–æ–≤–∏–∫** –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π;
- –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
- –≤—ã–¥–∞—ë—Ç **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç** —Å —à–∞–≥–∞–º–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
            """.trimIndent(),
            description = "–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã",
            isSystem = true
        )
    }
}
