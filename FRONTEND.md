# Веб-интерфейс ResearchAI Chat

Документация по фронтенду приложения.

## Структура файлов

```
src/main/resources/static/
├── index.html    # HTML разметка
├── style.css     # Стили интерфейса
└── app.js        # JavaScript логика
```

## Компоненты интерфейса

### 1. Область переписки (80% высоты)
- Отображает историю сообщений
- Автоматическая прокрутка к последнему сообщению
- Три типа сообщений:
  - **Пользователь** - фиолетовый градиент, справа
  - **Claude** - белый, слева
  - **Ошибка** - желтый фон с предупреждением

### 2. Область ввода (20% высоты)
- Многострочное текстовое поле
- Автоматическое изменение высоты при вводе
- Кнопка отправки с иконкой
- Статус-бар для уведомлений

## Функциональность

### Отправка сообщений

**Способы отправки:**
- Нажатие кнопки "Отправить"
- Клавиша `Enter` (без Shift)
- `Shift + Enter` - новая строка (не отправляет)

**Процесс отправки:**
1. Сообщение пользователя отображается сразу
2. Показывается индикатор загрузки (три анимированных точки)
3. Отправляется POST запрос к `/chat`
4. Ответ отображается в чате
5. При ошибке - отображается "Что-то пошло не так"

### Обработка ошибок

**Типы ошибок:**
- **Таймаут** (30 секунд) - "Что-то пошло не так (превышено время ожидания)"
- **Нет соединения** - "Что-то пошло не так (нет соединения с сервером)"
- **Ошибка сервера** - "Что-то пошло не так"

### Индикатор загрузки

Анимированные три точки показываются во время ожидания ответа от сервера:

```
●  ●  ●
```

Точки плавно прыгают вверх-вниз с задержкой между собой.

## API взаимодействие

### Запрос к серверу

```javascript
POST /chat
Content-Type: application/json

{
  "message": "Привет, Claude!"
}
```

### Ожидаемый ответ

```javascript
HTTP 200 OK
Content-Type: application/json

{
  "response": "Здравствуйте! Как я могу помочь?"
}
```

### Таймаут

Запрос автоматически отменяется через 30 секунд:

```javascript
const REQUEST_TIMEOUT = 30000; // 30 секунд
```

## Стили и дизайн

### Цветовая схема

- **Фон страницы:** Фиолетовый градиент (`#667eea` → `#764ba2`)
- **Сообщения пользователя:** Фиолетовый градиент
- **Сообщения Claude:** Белый с тенью
- **Ошибки:** Желтый (`#fff3cd`)

### Анимации

- **fadeIn** - плавное появление сообщений (0.3s)
- **typing** - анимация точек индикатора загрузки (1.4s)
- **hover** - увеличение кнопки при наведении

### Адаптивность

**Брейкпоинт:** `768px`

На мобильных устройствах:
- Сообщения занимают до 85% ширины (вместо 70%)
- Уменьшенные отступы
- Меньший размер шрифта

## Настройка

### Изменение API endpoint

В файле `app.js`:

```javascript
const API_URL = '/chat'; // Измените на свой endpoint
```

### Изменение таймаута

```javascript
const REQUEST_TIMEOUT = 30000; // Время в миллисекундах
```

### Изменение цветов

В файле `style.css` измените градиент:

```css
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
```

## Расширение функциональности

### Добавление истории чата

Сохранение сообщений в localStorage:

```javascript
// Сохранение
localStorage.setItem('chatHistory', JSON.stringify(messages));

// Загрузка при старте
const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
```

### Добавление Markdown поддержки

Подключите библиотеку (например, marked.js):

```html
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
```

В app.js измените отображение:

```javascript
contentDiv.innerHTML = marked.parse(text);
```

### Добавление кнопки "Очистить чат"

```javascript
function clearChat() {
    const messages = document.querySelectorAll('.message');
    messages.forEach(msg => msg.remove());

    // Показать приветствие
    addWelcomeMessage();
}
```

## Отладка

### Просмотр запросов

Откройте Developer Tools (F12) → Network

Фильтр по:
- **XHR** - увидите POST запросы к `/chat`
- **Payload** - тело запроса
- **Response** - ответ сервера

### Консольные логи

Ошибки автоматически логируются в консоль:

```javascript
console.error('Error:', error);
```

### Проверка состояния

Добавьте временный лог в `handleSendMessage()`:

```javascript
console.log('Sending message:', message);
console.log('Response:', data);
```

## Производительность

### Оптимизация

- ✅ Minimal DOM manipulation
- ✅ CSS анимации (не JavaScript)
- ✅ Debounce для resize textarea (встроенный)
- ✅ Smooth scrolling через CSS

### Метрики

- **Размер HTML:** ~2 KB
- **Размер CSS:** ~5 KB
- **Размер JS:** ~4 KB
- **Общий размер:** ~11 KB (без сжатия)

## Тестирование

### Ручное тестирование

1. ✅ Отправка сообщения по Enter
2. ✅ Отправка по кнопке
3. ✅ Shift+Enter создает новую строку
4. ✅ Обработка таймаута (отключите сервер)
5. ✅ Обработка ошибок API
6. ✅ Прокрутка к последнему сообщению
7. ✅ Адаптивность на мобильных

### Browser support

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

## Безопасность

### XSS защита

Используется `textContent` вместо `innerHTML`:

```javascript
contentDiv.textContent = text; // Безопасно
// contentDiv.innerHTML = text; // НЕ безопасно!
```

### CORS

CORS настроен на сервере в `Application.kt`:

```kotlin
install(CORS) {
    anyHost()
    allowHeader("Content-Type")
}
```

## FAQ

**Q: Можно ли изменить позицию сообщений?**
A: Да, измените `justify-content` в классах `.message.user` и `.message.assistant`

**Q: Как добавить аватары?**
A: Добавьте `<img>` элемент в `.message` перед `.message-content`

**Q: Можно ли сохранить историю чата?**
A: Да, используйте localStorage или отправляйте на сервер

**Q: Как сделать темную тему?**
A: Создайте CSS переменные и переключайте их через JavaScript

## Контрибьюция

Для улучшения фронтенда:

1. Отредактируйте файлы в `src/main/resources/static/`
2. Пересоберите проект: `./gradlew build`
3. Перезапустите сервер

Изменения в статических файлах требуют пересборки, так как они упаковываются в JAR.
